@Library('pipeline-library@pull/259/head') _

// parallel(
//   failFast: true,
//   'docker-image': {
//     // Do not rebuild the image when triggered by a periodic job
//     if (!currentBuild.getBuildCauses().contains("hudson.triggers.TimerTrigger")){
//       buildDockerAndPublishImage('helmfile', [
//         mainBranch: 'main',
//         automaticSemanticVersioning: true,
//         gitCredentials: 'github-app-infra'
//       ])
//     }
//   },
//   'updatecli': {
//     withCredentials([string(credentialsId: 'updatecli-github-token', variable: 'UPDATECLI_GITHUB_TOKEN')]) {
//       updatecli(action: 'diff')
//       if (env.BRANCH_NAME == 'main') {
//         updatecli(action: 'apply', cronTriggerExpression: '@weekly')
//       }
//     }
//   },
// )
parallelDockerUpdatecli([imageName: 'helmfile', rebuildImageOnPeriodicJob: false])
